# Hidden Castle Bonus Room Feature

## Overview
Added a secret **CASTLE-themed bonus room** in Level 1 with a 10-second time limit, unique castle architecture, and special coins.

---

## ✨ Features Added

### 1. **Hidden Portal Entry**
- **Location**: Level 1 at coordinates (90, GROUND_LEVEL - 8)
- **Visual**: Yellow `?` symbol on light blue background
- **Trigger**: Walk close to the portal (within 2 units)
- **One-time**: Portal disappears after first use

### 2. **Castle Bonus Room Environment**
- **Theme**: Medieval castle with towers and battlements
- **Background**: Pure black (contrasts with main game)
- **Architecture**: Gray stone castle structures
- **UI Color**: Yellow text on black background
- **Duration**: 10-second timer (displayed in UI)
- **Coins**: 10 special bonus coins in castle tower pattern
- **Layout**: Unique castle design (NOT found in main levels)

### 3. **Castle Architecture**
```
CASTLE LAYOUT:
- 4 Stone Towers (gray solid blocks)
- 5 Platform Battlements (varied heights)
- Tower Pattern: Small → Tall → Tall → Small
- Center Keep: Highest platform at middle
- Coin Distribution: Along tower heights
```

### 4. **Bonus Room Timer**
```
Timer Display: "*** CASTLE BONUS ***  TIME: [seconds]"
- Starts at 15 seconds (increased for easier collection)
- Counts down every second
- Main game timer PAUSED during bonus room
- Automatic exit when timer reaches 0
```

### 5. **Auto-Return System**
- **Return Position**: Saves position before entering
- **Exit Message**: "BONUS COMPLETE!" (1 second)
- **Restoration**: Returns to exact entry point
- **Layout Restoration**: Fully restores original level layout
- **Coin State**: Collected coins stay collected
- **Level State**: Returns to same screen version

---

## 🎮 How It Works

### Entry Sequence:
1. Player discovers yellow `?` portal in Level 1
2. Walk into portal (proximity detection)
3. **Sound Effect**: Power-up sound plays
4. Screen clears → Black background
5. Mario repositioned to castle center (X=55)
6. 15-second timer begins (increased from 10)
7. **Castle architecture loads** (unique design)

### During Castle Bonus:
- **Black background** with gray castle towers
- **Yellow UI** for visibility
- **10 collectible coins** arranged in tower pattern (200 points each)
- **Castle platforms** (gray battlements - solid blocks)
- **Tower walls** (gray stone - solid blocks)
- **No enemies** (safe collection time)
- **15-second timer** displayed prominently (increased for easier play)
- **Main timer paused** (no penalty)

### Castle Design Features:
- **Gray stone blocks** (ASCII 219) instead of bricks
- **Smaller layout** than main levels (more compact)
- **Tower structure**: 4 vertical towers with platforms
- **Unique coin placement**: Along castle battlements
- **Center keep**: Highest platform in middle

### Exit Sequence:
1. Timer reaches 0 seconds
2. "BONUS COMPLETE!" message displays (1 sec)
3. **Sound Effect**: Level complete sound
4. **Full restoration**: 
   - Original level platforms reloaded
   - Original level walls reloaded
   - Original level coin positions restored
5. Return to exact entry position
6. Resume normal game with collected coins

---

## 📊 Technical Implementation

### New Variables:
```assembly
; Castle bonus room state
inBonusRoom BYTE 0
bonusRoomTimer DWORD 10
bonusRoomTimerCounter BYTE 0
bonusRoomActive BYTE 1
bonusRoomEntryX BYTE 90
bonusRoomEntryY BYTE GROUND_LEVEL - 8
returnFromBonusX BYTE 90
returnFromBonusY BYTE GROUND_LEVEL

; Castle layout data
bonusRoomCoinCount = 10
bonusRoomCoinX BYTE [25, 30, 35, 45, 50, 55, 65, 70, 75, 85]
bonusRoomCoinY BYTE [castle tower heights]

bonusRoomPlatformCount = 5
bonusRoomPlatformX BYTE [20, 40, 60, 80, 50]
bonusRoomPlatformY BYTE [battlements at varied heights]
bonusRoomPlatformWidth BYTE [8, 8, 8, 8, 6]

bonusRoomWallCount = 4
bonusRoomWallX BYTE [23, 43, 63, 83]  ; Tower positions
bonusRoomWallYTop BYTE [tower tops]
bonusRoomWallYBottom BYTE [tower bases]
```

### Castle vs Main Level Differences:

| Feature | Main Levels | Castle Bonus Room |
|---------|------------|-------------------|
| **Background** | Light Blue / Black | Pure Black |
| **Platforms** | Bricks (═) / = | Gray Blocks (█) |
| **Walls** | Pipes (│) / # | Gray Towers (█) |
| **Color** | Multi-color | Gray + Yellow |
| **Size** | Full width (120) | Compact (70 units) |
| **Layout** | Linear/zigzag | Castle towers |
| **Coin Pattern** | Scattered | Tower arrangement |
| **Enemies** | Goomba, Koopa | None (safe) |

### Modified Procedures:
- **EnterBonusRoom**: Loads castle layout (platforms + walls)
- **ExitBonusRoom**: Fully restores original level layout
- **DrawLevel**: Castle-specific rendering (gray solid blocks)
- **DrawUI**: Shows "*** CASTLE BONUS ***"
- **UpdateGame**: Pauses main timer in bonus room

---

## 🎨 Visual Design

### Normal Level 1:
```
Background: Light Blue
Portal: Yellow ? on light blue
Platforms: Brown bricks
Walls: Green pipes
```

### Castle Bonus Room:
```
Background: Pure Black
Title: "*** CASTLE BONUS ***"
UI: Yellow text
Mario: Yellow 'M'
Coins: Yellow 'O'
Platforms: Gray solid blocks (█)
Towers: Gray solid blocks (█)
Timer: "TIME: 10" → "TIME: 0"

Castle Structure:
    [█]         [█]
   [███]       [███]
    [█]   [█]   [█]
   [███] [███] [███]
    [█]   [█]   [█]
```

---

## 🎵 Sound Effects

| Event | Sound |
|-------|-------|
| **Portal Entry** | `SOUND_POWERUP` (1200 Hz, long) |
| **Timer Countdown** | (Silent - visual only) |
| **Exit Bonus Room** | `SOUND_LEVEL_COMPLETE` (1500 Hz, medium) |

---

## 💰 Rewards

### Castle Bonus Benefits:
- **10 Coins** = +2000 points (200 per coin)
- **No Risk** = No enemies or hazards
- **Time Bonus** = Main timer paused (save ~10 seconds)
- **Unique Experience** = Castle architecture exploration
- **One-time reward** = Portal disappears after use

### Strategic Value:
- **High Score**: +2000 points guaranteed
- **Time Management**: Pause main timer
- **Exploration Reward**: Finding secret area
- **Optional**: Can skip if preferred

---

## 🔧 Castle Layout Configuration

### Easy Adjustments:
```assembly
; Castle dimensions
bonusRoomTimer DWORD 10        ; Change to 15 for easier
bonusRoomCoinCount = 10        ; Increase to 15 for more coins
bonusRoomPlatformCount = 5     ; Add more battlements
bonusRoomWallCount = 4         ; Add more towers

; Portal location
bonusRoomEntryX BYTE 90        ; Move portal position
bonusRoomEntryY BYTE GROUND_LEVEL - 8
```

### Castle Coin Pattern:
```assembly
; Current: Tower arrangement
; X positions: 25-85 (castle area)
; Y positions: GROUND_LEVEL - 3 to -13 (tower heights)
; Pattern: Arranged along castle battlements
```

---

## 🎯 Player Experience

### Discovery:
- **Subtle placement** at elevated position
- **Distinct visual** (yellow `?` portal)
- **Curiosity reward** for exploration
- **Unique environment** (castle theme)

### Challenge:
- **Time pressure** (10 seconds)
- **Vertical collection** (climb towers)
- **Platform navigation** (castle battlements)
- **Movement skill** required

### Reward:
- **Immediate points** (+2000)
- **Time saved** (main timer paused)
- **Unique experience** (castle exploration)
- **Satisfaction** (secret discovered)

---

## 🏰 Castle Design Philosophy

### Why Castle Theme?
1. **Distinct Identity**: Clearly different from main levels
2. **Medieval Aesthetic**: Fits Mario universe
3. **Vertical Challenge**: Tower climbing
4. **Compact Design**: Smaller, focused layout
5. **Visual Appeal**: Gray stone blocks stand out

### Layout Differences:
- **Main Levels**: Horizontal exploration, varied terrain
- **Castle Bonus**: Vertical focus, compact towers
- **Architecture**: Stone castles vs pipes/bricks
- **Size**: Smaller footprint (more concentrated)

---

## 🐛 Edge Cases Handled

### Castle Layout:
✅ **Unique structures** - No overlap with main levels
✅ **Full restoration** - Platforms + walls restored on exit
✅ **Coin positions** - Properly restored to original layout
✅ **Screen version** - Handles both Screen 1 & 2

### Visual Consistency:
✅ **Gray castle blocks** - Clear castle theme
✅ **Yellow accents** - Coin/UI visibility
✅ **Black background** - Distinct from main game
✅ **Solid blocks** - Castle structure aesthetic

---

## 📈 Testing Checklist

- [x] Portal appears in Level 1
- [x] Collision detection works
- [x] Entry sound plays
- [x] Black background displays
- [x] Castle layout loads (platforms + walls)
- [x] Gray castle blocks render
- [x] Yellow theme applied
- [x] Timer counts down correctly
- [x] 10 coins collectible
- [x] Main timer pauses
- [x] Auto-exit at 0 seconds
- [x] Exit message shows
- [x] Full layout restoration works
- [x] Return position accurate
- [x] Exit sound plays
- [x] Portal doesn't reappear
- [x] Level reload resets portal

---

## 🎮 How to Find the Castle

**Location Guide:**
1. Start Level 1
2. Move right past first platforms
3. Look for elevated yellow `?` symbol
4. Jump to reach it (around X=90)
5. Walk into it → **CASTLE BONUS!**

**Visual Cue:**
```
Normal gameplay: Light blue background
       ↓
Yellow ? appears at mid-height
       ↓
Walk into it → BLACK SCREEN + GRAY CASTLE
       ↓
"*** CASTLE BONUS ***" with countdown timer
       ↓
Explore castle towers for coins!
```

---

## 🏆 Castle Bonus Strategy

### Optimal Collection:
1. **Start center** (spawn at X=55)
2. **Left tower first** (3 coins)
3. **Right tower second** (3 coins)
4. **Center keep** (high platform, 2 coins)
5. **Edge towers** (remaining 2 coins)
6. **Speed critical** (10 seconds tight)

### Tower Navigation:
- Jump between platforms (castle battlements)
- Use tower walls for reference
- Vertical focus (up then down)
- Center keep = highest point

---

## ✅ Summary

**Added:**
- Hidden castle bonus room with unique architecture
- Gray stone castle structures (towers + battlements)
- 10-second timer challenge
- 10 coins in castle tower arrangement
- Compact, vertical layout (different from main levels)
- Full layout restoration system
- Castle-specific rendering

**Result:**
A rewarding **secret castle area** that adds:
- **Unique exploration** (castle theme)
- **Risk-free scoring** (+2000 points)
- **Time management** (main timer paused)
- **Distinct experience** (different from main levels)
- **High replayability** (speed challenge)

**Player Benefit:**
+2000 points + time saved + **unique castle experience** = **Major discovery reward**! 🏰💰⏱️✨

---

## ✨ Features Added

### 1. **Hidden Portal Entry**
- **Location**: Level 1 at coordinates (90, GROUND_LEVEL - 8)
- **Visual**: Yellow `?` symbol on light blue background
- **Trigger**: Walk close to the portal (within 2 units)
- **One-time**: Portal disappears after first use

### 2. **Bonus Room Environment**
- **Background**: Black screen (different from main game)
- **UI Color**: Yellow text on black background
- **Duration**: 10-second timer (displayed in UI)
- **Coins**: 10 special bonus coins scattered across the room
- **Coin Positions**: Various heights (Y: 5-13 blocks above ground)

### 3. **Bonus Room Timer**
```
Timer Display: "BONUS ROOM!  TIME: [seconds]"
- Starts at 10 seconds
- Counts down every second
- Main game timer PAUSED during bonus room
- Automatic exit when timer reaches 0
```

### 4. **Auto-Return System**
- **Return Position**: Saves position before entering
- **Exit Message**: "BONUS COMPLETE!" (1 second)
- **Restoration**: Returns to exact entry point
- **Coin State**: Collected coins stay collected
- **Level State**: Returns to same screen version

---

## 🎮 How It Works

### Entry Sequence:
1. Player discovers yellow `?` portal in Level 1
2. Walk into portal (proximity detection)
3. **Sound Effect**: Power-up sound plays
4. Screen clears → Black background
5. Mario repositioned to start of bonus room
6. 10-second timer begins

### During Bonus Room:
- **Black background** throughout
- **Yellow UI** for visibility
- **10 collectible coins** worth 200 points each
- **No enemies** (safe collection time)
- **Timer countdown** displayed prominently
- **Main timer paused** (no penalty)

### Exit Sequence:
1. Timer reaches 0 seconds
2. "BONUS COMPLETE!" message displays (1 sec)
3. **Sound Effect**: Level complete sound
4. Return to exact entry position
5. Resume normal game with collected coins

---

## 📊 Technical Implementation

### New Variables:
```assembly
inBonusRoom BYTE 0                    ; 0=normal, 1=in bonus room
bonusRoomTimer DWORD 10               ; Countdown timer (seconds)
bonusRoomTimerCounter BYTE 0          ; Frame counter
bonusRoomActive BYTE 1                ; Portal availability
bonusRoomEntryX BYTE 90               ; Portal X position
bonusRoomEntryY BYTE GROUND_LEVEL - 8 ; Portal Y position
returnFromBonusX BYTE 90              ; Return position X
returnFromBonusY BYTE GROUND_LEVEL    ; Return position Y

; 10 bonus room coins
bonusRoomCoinCount = 10
bonusRoomCoinX BYTE [positions]
bonusRoomCoinY BYTE [heights]
bonusRoomCoinActive BYTE [states]
```

### New Procedures:
1. **CheckBonusRoomEntry** - Detects portal collision
2. **DrawBonusRoomPortal** - Renders `?` symbol
3. **EnterBonusRoom** - Transitions to bonus room
4. **ExitBonusRoom** - Returns to main game
5. **UpdateBonusRoomTimer** - Countdown logic

### Modified Procedures:
- **DrawUI**: Shows bonus room title + timer
- **DrawPlayer**: Yellow Mario in bonus room
- **DrawCoins**: Yellow coins on black background
- **UpdateGame**: Pauses main timer in bonus room
- **gameMainLoop**: Black screen clearing
- **LoadLevel**: Resets bonus room state

---

## 🎨 Visual Design

### Normal Level 1:
```
Background: Light Blue
Portal: Yellow ? on light blue
```

### Bonus Room:
```
Background: Pure Black
UI: Yellow text
Mario: Yellow 'M'
Coins: Yellow 'O'
Timer: "TIME: 10" → "TIME: 0"
Title: "BONUS ROOM!"
```

---

## 🎵 Sound Effects

| Event | Sound |
|-------|-------|
| **Portal Entry** | `SOUND_POWERUP` (1200 Hz, long) |
| **Timer Countdown** | (Silent - visual only) |
| **Exit Bonus Room** | `SOUND_LEVEL_COMPLETE` (1500 Hz, medium) |

---

## 💰 Rewards

### Bonus Room Benefits:
- **10 Coins** = +2000 points (200 per coin)
- **No Risk** = No enemies or hazards
- **Time Bonus** = Main timer paused (save ~10 seconds)
- **Extra Challenge** = Speed collection mini-game

### Strategic Value:
- **High Score**: +2000 points guaranteed
- **Time Management**: Pause main timer
- **One-Time Bonus**: Portal disappears after use
- **Optional**: Can skip if preferred

---

## 🔧 Configuration

### Easy Adjustments:
```assembly
; Modify these for different difficulty:

bonusRoomTimer DWORD 10        ; Change to 15 for easier
bonusRoomCoinCount = 10        ; Increase to 15 for more coins
bonusRoomEntryX BYTE 90        ; Move portal location
bonusRoomEntryY BYTE GROUND_LEVEL - 8  ; Change portal height
```

### Coin Layout:
```assembly
; Current spread: X = 20 to 110 (full width)
; Heights vary: Y = GROUND_LEVEL - 5 to -13
; Pattern: Scattered for exploration
```

---

## 🎯 Player Experience

### Discovery:
- **Subtle placement** at height (not on ground)
- **Distinct color** (yellow `?` stands out)
- **Curiosity reward** for exploration

### Challenge:
- **Time pressure** (10 seconds)
- **Coin hunting** (scattered layout)
- **Movement skill** (platforming required)

### Reward:
- **Immediate points** (+2000)
- **Time saved** (main timer paused)
- **Satisfaction** (secret found)

---

## 🐛 Edge Cases Handled

### Portal Mechanics:
✅ **Can't re-enter** - Portal deactivates after first use
✅ **Screen persistence** - Works on both Level 1 screens
✅ **Level reload** - Portal resets when restarting level

### Timer Management:
✅ **Main timer paused** - No penalty during bonus room
✅ **Frame-accurate** - 10 frames = 1 second
✅ **No glitches** - Clean countdown

### Position Saving:
✅ **Exact return** - Same X, Y coordinates
✅ **State preserved** - Collected coins stay collected
✅ **Screen version** - Returns to correct screen

### Visual Consistency:
✅ **Color switching** - Proper theme for each mode
✅ **UI updates** - Correct labels displayed
✅ **Ground line** - Always visible at bottom

---

## 📈 Testing Checklist

- [x] Portal appears in Level 1
- [x] Collision detection works
- [x] Entry sound plays
- [x] Black background displays
- [x] Yellow theme applied
- [x] Timer counts down correctly
- [x] Coins collectible (all 10)
- [x] Main timer pauses
- [x] Auto-exit at 0 seconds
- [x] Exit message shows
- [x] Return position accurate
- [x] Exit sound plays
- [x] Portal doesn't reappear
- [x] Level reload resets portal

---

## 🎮 How to Find the Bonus Room

**Location Guide:**
1. Start Level 1
2. Move right past first platforms
3. Look for elevated yellow `?` symbol
4. Jump to reach it (around X=90)
5. Walk into it to enter!

**Visual Cue:**
```
Normal gameplay: Light blue background
       ↓
Yellow ? appears at mid-height
       ↓
Walk into it → BLACK SCREEN
       ↓
"BONUS ROOM!" with countdown timer
```

---

## 🏆 High Score Strategy

### Optimal Play:
1. **Collect main coins first** (longer to find)
2. **Enter bonus room last** (guaranteed points)
3. **Speed collection** (10 seconds is tight)
4. **Maximum points** = Main coins + Bonus coins

### Time Management:
- Main timer pauses during bonus
- Effective time bonus ≈ 10 seconds saved
- Time bonus at end = +500 points
- **Net gain**: +2500 total from bonus room

---

## 🔮 Future Enhancement Ideas

1. **Multiple Portals** - Different bonus rooms per screen
2. **Difficulty Scaling** - Shorter time in later levels
3. **Power-ups** - Special items only in bonus room
4. **Secret Paths** - Hidden exits to skip sections
5. **Score Multiplier** - 2x points during bonus time
6. **Coin Patterns** - Spell words or shapes
7. **Moving Coins** - Extra challenge for skilled players
8. **Combo System** - Fast collection = bonus multiplier

---

## ✅ Summary

**Added:**
- Hidden bonus room with 10-second timer
- Black background theme
- Yellow visual style
- Portal entry system
- 10 collectible coins
- Auto-exit mechanism
- Main timer pause
- Position save/restore

**Result:**
A rewarding secret area that adds:
- **Exploration incentive**
- **Risk-free scoring opportunity**
- **Time management strategy**
- **High replayability value**

**Player Benefit:**
+2000 points + time saved = **Major advantage** for finding the secret! 🎉
